
# Modules that comprise the runtime library.

OBJS = upc_access.lo \
       upc_accessg.lo \
       upc_addr.lo \
       $(UPC_AFFINITY_SUP).lo \
       upc_alloc.lo \
       upc_allocg.lo \
       upc_barrier.lo \
       upc_coll_prefix_reduce.lo \
       upc_coll_reduce.lo \
       upc_coll_broadcast.lo \
       upc_coll_err.lo \
       upc_coll_exchange.lo \
       upc_coll_gather_all.lo \
       upc_coll_gather.lo \
       upc_coll_init.lo \
       upc_coll_permute.lo \
       upc_coll_scatter.lo \
       upc_coll_sort.lo \
       upc_gasp.lo \
       upc_lock.lo \
       upc_main.lo \
       upc_mem.lo \
       upc_libg.lo \
       $(UPC_NUMA_SUP).lo \
       upc_pgm_info.lo \
       upc_pupc.lo \
       upc_sysdep.lo \
       upc_vm.lo

ifeq ($(BUILD_UPC_GUM_DEBUG), yes)
OBJS += upc_gum.lo
endif

# Runtime library compiled for pthreads model

PT = pt

PT_OBJS = $(OBJS:%=$(PT)_%)

### runtime source directories

target_srcdir=$(srcdir)/smp

TARGET_SRC_HDRS = config.h \
		  $(target_srcdir)/upc_access.h \
                  $(target_srcdir)/upc_affinity.h \
                  $(target_srcdir)/upc_coll.h \
                  $(target_srcdir)/upc_config.h \
		  $(target_srcdir)/upc_debug.h \
		  $(target_srcdir)/upc_defs.h \
                  $(target_srcdir)/upc_lib.h \
		  $(target_srcdir)/upc_mem.h \
		  $(target_srcdir)/upc_numa.h \
		  $(target_srcdir)/upc_pts.h \
		  $(target_srcdir)/upc_pupc.h \
                  $(target_srcdir)/upc_sup.h \
                  $(target_srcdir)/upc_sync.h \
		  $(target_srcdir)/upc_sysdep.h

TARGET_SRC_INLINE = config.h \
		    $(target_srcdir)/upc_access.c \
		    $(target_srcdir)/upc_access.h \
		    $(target_srcdir)/upc_config.h \
		    $(target_srcdir)/upc_defs.h \
		    $(target_srcdir)/upc_mem.h \
		    $(target_srcdir)/upc_pts.h \
		    $(target_srcdir)/upc_sup.h \
		    $(target_srcdir)/upc_sync.h


TARGET_DEFS =

### build definitions

GCC_UPC_LIB_H  = gcc-upc-lib.h
GCC_UPC_LIB_IN = $(incdir)/gcc-upc-lib.in
GEN_GCC_UPC_LIB_H = $(target_srcdir)/gen-gccupc-inline-lib.pl

GCCUPC_LD_SCRIPT = gccupc.ld
GEN_GCCUPC_LD_SCRIPT = $(target_srcdir)/gen-gccupc-ld-script.pl

UPC_COLL_PREFIX_REDUCE_IN = \
	$(target_srcdir)/upc_coll_prefix_reduce.in
UPC_COLL_PREFIX_REDUCE_UPC = \
	$(target_srcdir)/upc_coll_prefix_reduce.upc
UPC_COLL_REDUCE_IN = \
	$(target_srcdir)/upc_coll_reduce.in
UPC_COLL_REDUCE_UPC = \
	$(target_srcdir)/upc_coll_reduce.upc
GEN_GCC_COLL_REDUCE = $(target_srcdir)/gen-upc-coll-reduce.pl

# treat warnings as errors
WFLAGS = -W -Wall -Wwrite-strings -Wstrict-prototypes -Werror

DFLAGS = -O0 -g
ALL_CFLAGS = -I. -I$(target_srcdir) -I$(incdir) -I$(srcdir) $(WFLAGS) \
             $(DFLAGS) $(CPPFLAGS) $(CFLAGS) $(TARGET_DEFS) $(TARGET_CFLAGS) \
	     -DIN_GCC -DIN_TARGET_LIBS -D_UPC_COLL_CHECK_ARGS

L_CC=$(LIBTOOL_COMPILE) $(CC) -c $(ALL_CFLAGS) $(INCLUDES)
L_CC_UPC=$(LIBTOOL_COMPILE) $(CC_UPC) -c $(ALL_CFLAGS) $(INCLUDES)
